"use strict";!function(w,E,k){"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e,t){var n,o;for(n=0,o=this.length;n<o;++n)n in this&&e.call(t,this[n],n,this)}),"function"!=typeof Array.prototype.indexOf&&(Array.prototype.indexOf=function(e,t){var n=-1;t=1*t||0;for(var o=0,i=this.length;o<i;o++)if(t<=o&&this[o]===e){n=o;break}return n}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var X=E.addEventListener?function(e,t,n,o){e.addEventListener(t,n,o||!1)}:function(t,e,n){n.prototype._bindFun||(n.prototype._bindFun=[]);var o=!0;for(var i in n.prototype._bindFun)if(n.prototype._bindFun[i].type===e&&n.prototype._bindFun[i].element===t){o=!1;break}if(!0===o){var a={type:e,element:t,Function:function(e){n.call(t,e)}};n.prototype._bindFun.push(a),t.attachEvent("on"+e,a.Function)}},B=E.addEventListener?function(e,t,n){e.removeEventListener(t,n)}:function(e,t,n){for(var o in n.prototype._bindFun)if(n.prototype._bindFun[o].type===t&&n.prototype._bindFun[o].element===e){e.detachEvent("on"+t,n.prototype._bindFun[o].Function),n.prototype._bindFun.splice(o,1);break}};function M(e,t,n,o){var i=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"==typeof ActiveXObject)throw new Error("No XHR object available.");if("string"!=typeof arguments.callee.activeXString){var e,t,n=["MSXML2.XMLHttp.6.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp"];for(e=0,t=n.length;e<t;e++)try{new ActiveXObject(n[e]),arguments.callee.activeXString=n[e];break}catch(e){}}return new ActiveXObject(arguments.callee.activeXString)}();i.onreadystatechange=function(){4==i.readyState&&(200<=i.status&&i.status<300||304==i.status?o(null,i.responseText):o("request is unsucessful:"+i.status))},i.open(e,t,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(n)}function I(e){var t="";for(var n in e)t+=n+"="+e[n]+"&";return t}function L(e){if(E.getElementsByClassName)return E.getElementsByClassName(e);for(var t=[],n=E.getElementsByTagName("*"),o=0;o<n.length;o++)for(var i=n[o].className.split(" "),a=0;a<i.length;a++)if(i[a]==e){t.push(n[o]);break}return t}function e(e,t,n,o){this.getCodeUrl=e||"http://captcha.shenzhenmuseum.com/getCode",this.checkCodeUrl=t||"http://captcha.shenzhenmuseum.com/checkCode",this.imgspec=n||"200*100",this.imgx=null,this.imgy=null,this.shearSize=o||40,this.verify_id=null,this.maxError=4,this.mode=null}e.prototype._getStyle=function(e,t){if(e)return e.currentStyle?e.currentStyle[t]:getComputedStyle(e,!1)[t]},e.prototype._setStyle=function(e,t){if(e)for(var n in t)e.style[n]=t[n]},e.prototype._hasClass=function(e,t){return!!e.className&&e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},e.prototype._addClass=function(e,t){this._hasClass(e,t)||(e.className+=" "+t)},e.prototype._removeClass=function(e,t){if(this._hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}},e.prototype.getCodeCallback=function(e,t){},e.prototype.checkCodeCallback=function(e,t){},e.prototype.createCodeDiv=function(e,t,n,o){var i,a=E.getElementById(e),r=this,s=a.innerHTML="";"popupCode"==o&&(s+="<div id='container_layer'> </div>",s+="<div id='container_wrap_modal'>",s+="<div id='container_head' >",s+='<a class="refreshBtn" href="javascript:;" title="点击刷新验证码"><span class="refresh_bg"></span></a>',s+='<span id="close_modal" class="closeBtn"></span>',s+='<div class="title">安全验证</div>',s+="</div>"),s+="<div id='container_body' style='width:"+t+"px;height:"+n+"px; '><div class='container_box' style='width:"+t+"px;height:"+n+"px;position: relative;'>",s+="<div class='vcode-hints'style='width:"+t+"px;line-height:"+n/100*7+";'>正在载入...</div>";for(var l=0;l<20;l++)s+="<image  id='bb"+l+"' style=display:none; class='cut_bg'></image>";if(s+="<image id='xy_img'class='xy_img_bord'></image></div>",s+="<div id='drag' style='width:"+t+"px'></div></div>","popupCode"==o&&(s+="</div>"),a.innerHTML=s,"popupCode"==o){E.getElementById("container_wrap_modal");i=L("refresh_bg")[0],X(i,"click",function(e){r.init(!0)},!1)}},e.prototype.setCodeDivPopup=function(e,t,n,o,i){E.getElementById(e);var a=E.getElementById(t),r=E.getElementById(n),s=Math.max(E.body.scrollHeight,E.documentElement.scrollHeight),l=Math.max(E.body.scrollWidth,E.documentElement.scrollWidth);this._setStyle(a,{position:"absolute",zIndex:"100",width:l+"px",height:s+"px",left:"0px",top:"0px",background:"#000",filter:"alpha(opacity=50)",opacity:"0.50"});var d=Math.max(E.documentElement.clientHeight,E.body.clientHeight),c=Math.max(E.documentElement.clientWidth,E.body.clientWidth),p=E.body.scrollLeft+(c-o)/2,u=E.body.scrollTop+(d-i)/2;this._setStyle(r,{position:"absolute",zIndex:"9999",top:u+"px",left:p+"px",padding:"5px"})},e.prototype.createDragDiv=function(e,t,n){var o=this,i=E.getElementById("drag"),a='<div class="drag_bg"></div>';if(a+='<div class="drag_placeholder">向右拖动完成拼图</div>',a+='<div class="drag_text" style="width: '+e+'px" onselectstart="return false;" unselectable="on"></div>',a+='<div class="handler handler_bg"></div>',"embedCode"==n&&(a+='<a class="refreshBtn" href="javascript:;" title="点击刷新验证码"><span class="refresh_bg"></span></a>'),i.innerHTML=a,"embedCode"==n){var r=L("refreshBtn")[0];o._setStyle(i,{margin:0}),o._setStyle(r,{left:e-20+"px",top:"11px",position:"absolute"});var s=L("refresh_bg")[0];X(s,"click",function(e){o.init(!0)},!1)}},e.prototype.bindDragEvent=function(o,e){var i=this,a=E.getElementById("vcode"),r=L("handler")[0],s=L("drag_text")[0],l=L("drag_bg")[0],d=L("refresh_bg")[0],c=E.getElementById("xy_img"),p=0,u=0;setTimeout(function(){u=o-r.offsetWidth},0);var y=new Date,h=new Date,f=null,g=[],v=!1,t=0,n=0;function m(e){switch((e=e||w.event).type){case"mousedown":b(e.pageX||e.clientX);break;case"mousemove":x(e.pageX||e.clientX);break;case"mouseup":S(e.pageX||e.clientX)}}function _(e){switch((e=e||w.event).type){case"touchstart":b(e.targetTouches[0].pageX),X(E,"touchmove",C,!1);break;case"touchmove":x(e.targetTouches[0].pageX),n=e.targetTouches[0].pageX-t;break;case"touchend":S(n),B(E,"touchmove",C,!1)}}function b(e){i._setStyle(c,{display:"block"}),v=!0;var t=i._getStyle(c,"left");p=p||c.offsetWidth,f=e-parseInt(t,10),y=new Date}function x(e){var t=e-f,n=0;v&&0<t&&t<=u&&(n=parseInt(t*(o-p)/u),i._setStyle(c,{left:n+"px"}),i._setStyle(d,{display:"none"}),i._setStyle(r,{left:t+"px"}),i._setStyle(l,{width:t+"px"}),g.push([n,(new Date).getTime()]))}function S(e){if(v&&(v=!1,!isNaN(f)&&f!==k)){var t=Math.round((e-f)*(o-p)/u);if(t<10)return i._setStyle(d,{display:"block"}),i._setStyle(c,{left:"0px"}),i._setStyle(r,{left:"0px"}),void i._setStyle(l,{width:"0px"});h=new Date;var n=I({verify_id:i.verify_id,point:t,timespan:h-y,datelist:g.join("|")});M("POST",i.checkCodeUrl,n,function(e,t){if(i.checkCodeCallback&&i.checkCodeCallback(e,t,i.verify_id),!e)if(0===(t=JSON.parse(t)).state){for(var n=1;n<=4;n++);i._setStyle(r,{left:u+"px"}),i._setStyle(l,{width:u+"px"}),i._removeClass("xy_img_bord"),i._setStyle(c,{border:"1px solid rgb(255,255,255)"});var o=L("refreshBtn")[0];o.parentNode.removeChild(o),i._removeClass(r,"handler_bg"),i._addClass(r,"handler_ok_bg"),i._removeClass(s,"drag_text_err"),i._addClass(s,"drag_text_ok"),s.innerHTML='<b class="right_icon"></b>验证通过',i._setStyle(drag,{color:"#fff"}),B(r,"mousedown",m),B(E,"mousemove",m),B(E,"mouseup",m),B(r,"touchstart",_),B(E,"touchmove",_),B(E,"touchend",_),i._setStyle(d,{display:"none"}),"popupCode"==i.mode&&setTimeout(function(){i._setStyle(a,{display:"none"})},1e3)}else i._setStyle(d,{display:"block"}),i._setStyle(c,{left:"0px"}),i._setStyle(r,{left:"0px"}),i._setStyle(l,{width:"0px"}),t.msg>i.maxError?i.init(!0):(s.innerHTML="验证失败，请重新验证!",i._addClass(s,"drag_text_err"))})}}function C(e){e.preventDefault()}X(r,"mousedown",m),X(E,"mousemove",m),X(E,"mouseup",m),X(r,"mouseout",function(e){}),X(r,"touchstart",_),X(r,"touchmove",_),X(r,"touchend",_)},e.prototype.getcode=function(p,e,t){var u=this,y=(E.getElementById(p),E.getElementById("drag")),h=L("drag_text")[0],f=L("cut_bg"),g=L("refresh_bg")[0],v=E.getElementById("xy_img"),n=I({spec:u.imgspec,shearSize:u.shearSize});M("POST",u.getCodeUrl,n,function(e,t){if(u.getCodeCallback&&u.getCodeCallback(e,t),!e&&-1!==(t=JSON.parse(t)).state){0!==t.errcode&&(E.getElementById(p).innerHTML="<span style='color:red'>验证码获取失败,"+t.errmsg+"</span>");var n=t.y,o=t.small,i=(t.array,t.normal),a=t.imgx,r=t.imgy,s=t.verify_id;u.verify_id=s;for(var l=0;l<f.length;l++){var d=f[l];d.setAttribute("src",i[l]),u._setStyle(d,{display:"block",width:a/10+"px",height:r/2+"px"})}u._setStyle(v,{position:"absolute",top:n+"px"}),v.setAttribute("src",o),u._setStyle(y,{width:a+"px"}),u._setStyle(h,{width:a+"px"}),u._setStyle(g,{left:a-25+"px",display:"block"});var c=L("vcode-hints")[0];c&&c.parentNode.removeChild(c)}})},e.prototype.init=function(e,t){var n=this,o=(s=E.getElementById("vcode")).className||"embedCode";this.mode=o;var i=this.imgspec.split("*"),a=i[0],r=i[1];if(this.imgx=a,this.imgy=r,this.createCodeDiv("vcode",a,r,o),"popupCode"==o){var s=E.getElementById("vcode");this.setCodeDivPopup("vcode","container_layer","container_wrap_modal",a,r);var l=E.getElementById("close_modal");n._setStyle(s,{display:"block"}),"function"==typeof t&&t(n,s),X(l,"click",function(e){n._setStyle(s,{display:"none"})})}"popupCode"!=o||e||n._setStyle(s,{display:"none"}),this.createDragDiv(a,r,o),this.bindDragEvent(a,r),this.getcode("vcode",a,r)},w.VerficationCode=e}(window,document,void 0);